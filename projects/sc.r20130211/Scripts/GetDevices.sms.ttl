# baseURI: http://www.cmusv.edu/SmartCommunity/Scripts/Devices
# imports: http://topbraid.org/sparqlmotionfunctions
# imports: http://topbraid.org/sparqlmotionlib-tbc

@prefix devices:  <http://www.cmusv.edu/SmartCommunity/Scripts/Devices#> .
@prefix owl:     <http://www.w3.org/2002/07/owl#> .
@prefix rdf:     <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs:    <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sm:      <http://topbraid.org/sparqlmotion#> .
@prefix sml:     <http://topbraid.org/sparqlmotionlib#> .
@prefix sp:      <http://spinrdf.org/sp#> .
@prefix spin:    <http://spinrdf.org/spin#> .
@prefix xsd:     <http://www.w3.org/2001/XMLSchema#> .

<http://www.cmusv.edu/SmartCommunity/Scripts/Devices>
      rdf:type owl:Ontology ;
      owl:imports <http://topbraid.org/sparqlmotionlib-tbc> , <http://topbraid.org/sparqlmotionfunctions> ;
      owl:versionInfo "Created with TopBraid Composer"^^xsd:string .

devices:ConstructDeviceInstances
      rdf:type sml:ApplyConstruct ;
      sm:next devices:ReturnSparqlResultsForDevices ;
      sml:constructQuery
              [ rdf:type sp:Construct ;
                sp:templates () ;
                sp:where ()
              ] ;
      sml:replace "true"^^xsd:boolean .

devices:ConvertDeviceJsonToRdf
      rdf:type sml:ConvertJSONToRDF ;
      sm:next devices:ExportRdfToDeviceRdfFile ;
      sm:outputVariable "root"^^xsd:string .

devices:ExportRdfToDeviceRdfFile
      rdf:type sml:ExportToRDFFile ;
      sm:next devices:ImportCombinedModel ;
      sml:baseURI "http://www.cmusv.edu/SmartCommunity/Scripts"^^xsd:string ;
      sml:targetFilePath "Output/Devices.rdf"^^xsd:string .

devices:ImportCombinedModel
      rdf:type sml:ImportRDFFromWorkspace ;
      sm:next devices:ConstructDeviceInstances ;
      sml:baseURI "http://www.cmusv.edu/SmartCommunity/Scripts"^^xsd:string ;
      sml:ignoreImports "false"^^xsd:boolean ;
      sml:sourceFilePath "/SmartCommunity/CombinedModel/1.1/CombinedModel.ttl"^^xsd:string .

devices:ImportDeviceJsonFromSensorRepo
      rdf:type sml:ImportTextFromURL ;
      sm:next devices:ConvertDeviceJsonToRdf ;
      sm:outputVariable "text"^^xsd:string ;
      sml:url "http://cmu-sds.herokuapp.com/get_devices"^^xsd:string .

devices:ReturnSparqlResultsForDevices
      rdf:type sml:ReturnSPARQLResults , sm:Function ;
      rdfs:subClassOf sm:Functions ;
      sml:serialization sm:XML .
