# baseURI: http://www.cmusv.edu/SmartCommunity/Scripts/Output/GetDevices2
# imports: http://topbraid.org/json
# imports: http://topbraid.org/sparqlmotionfunctions
# imports: http://topbraid.org/sparqlmotionlib-tbc

@prefix GetDevices2:  <http://www.cmusv.edu/SmartCommunity/Scripts/Output/GetDevices2#> .
@prefix email:   <http://topbraid.org/email#> .
@prefix json:    <http://topbraid.org/json#> .
@prefix owl:     <http://www.w3.org/2002/07/owl#> .
@prefix rdf:     <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs:    <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sm:      <http://topbraid.org/sparqlmotion#> .
@prefix sml:     <http://topbraid.org/sparqlmotionlib#> .
@prefix sp:      <http://spinrdf.org/sp#> .
@prefix spin:    <http://spinrdf.org/spin#> .
@prefix xsd:     <http://www.w3.org/2001/XMLSchema#> .

<http://www.cmusv.edu/SmartCommunity/Scripts/Output/GetDevices2>
      rdf:type owl:Ontology ;
      owl:imports <http://topbraid.org/sparqlmotionfunctions> , <http://topbraid.org/sparqlmotionlib-tbc> , <http://topbraid.org/json> ;
      owl:versionInfo "Created with TopBraid Composer"^^xsd:string .

GetDevices2:ApplyTopSpin
      rdf:type sml:ApplyTopSPIN ;
      sm:next GetDevices2:ReturnSparqlResults ;
      sml:flatten "false"^^xsd:boolean ;
      sml:predicate spin:rule ;
      sml:replace "true"^^xsd:boolean ;
      sml:singlePass "true"^^xsd:boolean .

GetDevices2:CollectGarbage_1
      rdf:type sml:CollectGarbage ;
      sm:next GetDevices2:Merge_2 ;
      sml:baseURI "http://www.cmusv.edu/SmartCommunity/Scripts/Output/Devices"^^xsd:string .

GetDevices2:CollectGarbage_BaseSessionGraph
      rdf:type sml:CollectGarbage ;
      sm:next GetDevices2:Merge_2 ;
      sml:baseURI "deviceRdf"^^xsd:string .

GetDevices2:CollectGarbage_SessionGraph
      rdf:type sml:CollectGarbage ;
      sm:next GetDevices2:Merge_2 ;
      sml:baseURI "urn:x-tb:session"^^xsd:string .

GetDevices2:ConvertJsonToRdf
      rdf:type sml:ConvertJSONToRDF ;
      sm:next GetDevices2:ExportRdfToFile_2 ;
      sm:outputVariable "deviceRdf"^^xsd:string .

GetDevices2:ExportRdfToFile_2
      rdf:type sml:ExportToRDFFile ;
      sm:next GetDevices2:Merge_1 ;
      sml:baseURI "http://www.cmusv.edu/SmartCommunity/Scripts/Output/Devices"^^xsd:string ;
      sml:targetFilePath "/SmartCommunity/Scripts/Output/Devices.rdf"^^xsd:string .

GetDevices2:ImportCombinedModel
      rdf:type sml:ImportRDFFromWorkspace ;
      sm:next GetDevices2:Merge_3 ;
      sml:baseURI "http://www.cmusv.edu/SmartCommunity/CombinedModel/1.1"^^xsd:string ;
      sml:ignoreImports "false"^^xsd:boolean ;
      sml:sourceFilePath "/SmartCommunity/CombinedModel/1.1/CombinedModel.ttl"^^xsd:string .

GetDevices2:ImportDeviceJsonFromSensorRepo
      rdf:type sml:ImportTextFromURL ;
      sm:next GetDevices2:ConvertJsonToRdf ;
      sm:outputVariable "text"^^xsd:string ;
      sml:url "http://cmu-sds.herokuapp.com/get_devices"^^xsd:string .

GetDevices2:ImportDeviceJsonWithUpdates
      rdf:type sml:ImportRDFFromWorkspace ;
      sm:next GetDevices2:Merge_3 ;
      sml:baseURI "http://www.cmusv.edu/SmartCommunity/Scripts/Output/Devices"^^xsd:string ;
      sml:ignoreImports "false"^^xsd:boolean ;
      sml:sourceFilePath "/SmartCommunity/Scripts/Output/Devices.rdf"^^xsd:string .

GetDevices2:ImportSpinRules
      rdf:type sml:ImportRDFFromWorkspace ;
      sm:next GetDevices2:Merge_3 ;
      sml:baseURI "http://www.cmusv.edu/SmartCommunity/Scripts/GetDevices2SPIN"^^xsd:string ;
      sml:ignoreImports "false"^^xsd:boolean ;
      sml:sourceFilePath "/SmartCommunity/Scripts/GetDevices2SPIN.ttl"^^xsd:string .

GetDevices2:Merge_1
      rdf:type sml:Merge ;
      sm:next GetDevices2:Merge_2 .

GetDevices2:Merge_2
      rdf:type sml:Merge ;
      sm:next GetDevices2:Merge_3 .

GetDevices2:Merge_3
      rdf:type sml:Merge ;
      sm:next GetDevices2:ApplyTopSpin .

GetDevices2:PerformUpdate_Device
      rdf:type sml:PerformUpdate ;
      sm:next GetDevices2:Merge_1 ;
      sml:updateQuery
              [ rdf:type sp:Modify ;
                sp:deletePattern ([ rdf:type sp:NamedGraph ;
                            sp:elements ([ sp:object
                                                [ sp:varName "o"^^xsd:string
                                                ] ;
                                        sp:predicate rdf:type ;
                                        sp:subject
                                                [ sp:varName "s"^^xsd:string
                                                ]
                                      ]) ;
                            sp:graphNameNode <http://www.cmusv.edu/SmartCommunity/Scripts/Output/Devices>
                          ]) ;
                sp:insertPattern ([ rdf:type sp:NamedGraph ;
                            sp:elements ([ sp:object json:Device ;
                                        sp:predicate rdf:type ;
                                        sp:subject
                                                [ sp:varName "s"^^xsd:string
                                                ]
                                      ]) ;
                            sp:graphNameNode <http://www.cmusv.edu/SmartCommunity/Scripts/Output/Devices>
                          ]) ;
                sp:where ([ rdf:type sp:NamedGraph ;
                            sp:elements ([ sp:object
                                                [ sp:varName "o"^^xsd:string
                                                ] ;
                                        sp:predicate rdf:type ;
                                        sp:subject
                                                [ sp:varName "s"^^xsd:string
                                                ]
                                      ] [ sp:object
                                                [ sp:varName "sensors"^^xsd:string
                                                ] ;
                                        sp:predicate json:sensors ;
                                        sp:subject
                                                [ sp:varName "s"^^xsd:string
                                                ]
                                      ]) ;
                            sp:graphNameNode <http://www.cmusv.edu/SmartCommunity/Scripts/Output/Devices>
                          ])
              ] .

GetDevices2:PerformUpdate_Location
      rdf:type sml:PerformUpdate ;
      sm:next GetDevices2:Merge_1 ;
      sml:updateQuery
              [ rdf:type sp:Modify ;
                sp:deletePattern ([ rdf:type sp:NamedGraph ;
                            sp:elements ([ sp:object
                                                [ sp:varName "o"^^xsd:string
                                                ] ;
                                        sp:predicate rdf:type ;
                                        sp:subject
                                                [ sp:varName "s"^^xsd:string
                                                ]
                                      ]) ;
                            sp:graphNameNode <http://www.cmusv.edu/SmartCommunity/Scripts/Output/Devices>
                          ]) ;
                sp:where ([ rdf:type sp:NamedGraph ;
                            sp:elements ([ sp:object
                                                [ sp:varName "o"^^xsd:string
                                                ] ;
                                        sp:predicate rdf:type ;
                                        sp:subject
                                                [ sp:varName "s"^^xsd:string
                                                ]
                                      ] [ sp:object
                                                [ sp:varName "lat"^^xsd:string
                                                ] ;
                                        sp:predicate json:lat ;
                                        sp:subject
                                                [ sp:varName "s"^^xsd:string
                                                ]
                                      ]) ;
                            sp:graphNameNode <http://www.cmusv.edu/SmartCommunity/Scripts/Output/Devices>
                          ])
              ] .

GetDevices2:ReturnSparqlResults
      rdf:type sml:ReturnSPARQLResults , sm:Function ;
      rdfs:subClassOf sm:Functions ;
      sml:selectQuery
              [ rdf:type sp:Select ;
                sp:where ([ sp:object
                                    [ sp:varName "o"^^xsd:string
                                    ] ;
                            sp:predicate
                                    [ sp:varName "p"^^xsd:string
                                    ] ;
                            sp:subject
                                    [ sp:varName "s"^^xsd:string
                                    ]
                          ])
              ] ;
      sml:serialization sm:XML .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .

[]    rdf:type json:location ;
      email:name "Hennessy" .
